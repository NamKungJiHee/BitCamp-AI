from sklearn.datasets import load_boston
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense
from sklearn.model_selection import train_test_split
import time

datasets = load_boston()
x = datasets.data
y = datasets.target

x_train, x_test, y_train, y_test = train_test_split(x, y, train_size=0.8, shuffle=True, random_state=66)

model = Sequential()
model.add(Dense(100,input_dim=13))
model.add(Dense(100))
model.add(Dense(100))
model.add(Dense(100))
model.add(Dense(50))
model.add(Dense(10))
model.add(Dense(1))

#3. 컴파일, 훈련
model.compile(loss='mse', optimizer='adam')

from tensorflow.keras.callbacks import EarlyStopping
es = EarlyStopping(monitor = 'val_loss', patience = 50, mode = 'min', verbose=1) #20번을 돌릴건데 최소값이 그 기간안에 안나오면 끝



start= time.time()
hist = model.fit(x_train, y_train, epochs=1000, batch_size=1, validation_split=0.2, callbacks=[es])   #여기서 loss & val_loss의 결과가 나옴  #es를 호출할거닷!
end= time.time()- start

print("걸린시간: ", round(end,3), '초')  #소수 3까지만 출력

#4. 평가, 예측
loss= model.evaluate(x_test, y_test)
print('loss: ', loss)

y_predict = model.predict(x_test)

from sklearn.metrics import r2_score
r2 = r2_score(y_test, y_predict) 
print('r2스코어 : ', r2)



import matplotlib.pyplot as plt
plt.figure(figsize=(9,5))

#print("=========================")
#print(hist)  
#print("=========================")
#print(hist.history)  
print("=========================")
print(hist.history['loss'])  
print("=========================")
print(hist.history['val_loss']) 



plt.plot(hist.history['loss'], marker = '.', c='red', label = 'loss')
plt.plot(hist.history['val_loss'], marker = '.', c='blue', label = 'val_loss')
plt.grid() #격자표시
plt.title('loss')
plt.ylabel('loss') #y축
plt.xlabel('epoch') #x축
plt.legend(loc='upper right') 
plt.show()



#Q)
'''
[96.59980010986328, 163.34158325195312, 133.01104736328125, 100.16996765136719, 94.88056945800781, 87.91163635253906, 89.83244323730469, 74.13589477539062, 133.40524291992188, 76.91596984863281, 78.31499481201172, 81.72142028808594, 117.23982238769531, 93.35395812988281, 184.46421813964844, 167.8431396484375, 64.3967514038086, 70.98804473876953, 58.11457061767578, 65.88575744628906, 96.36329650878906, 65.92418670654297, 68.5986328125, 56.41869354248047, 57.22021484375, 58.99156188964844, 146.7396240234375, 71.788330078125, 85.01808166503906, 50.04179763793945, 63.564300537109375, 55.35808563232422, 77.74573516845703, 47.59394073486328, 60.90245056152344, 71.21224975585938, 54.428627014160156, 45.781272888183594, 49.11723709106445, 49.995750427246094, 53.06172180175781, 45.760990142822266, 50.22022247314453, 81.56837463378906, 47.154998779296875, 49.94641876220703, 52.194000244140625, 49.64092254638672, 47.35775375366211, 56.48963165283203, 71.0497817993164, 54.67163848876953, 70.60382080078125, 51.99422073364258, 46.154727935791016, 45.163963317871094, 56.30028533935547, 54.60796356201172, 39.85435485839844, 44.437294006347656, 55.54469299316406, 48.880096435546875, 42.32326889038086, 48.50840759277344, 51.01162338256836, 45.19554901123047, 39.084022521972656, 37.22957229614258, 114.22332000732422, 39.032405853271484, 
42.295127868652344, 41.96265411376953, 56.706241607666016, 37.48478317260742, 43.04838562011719, 37.155662536621094, 41.46414566040039, 45.80248260498047, 56.263492584228516, 75.51092529296875, 42.67458724975586, 86.01702880859375, 40.28379821777344, 47.32606506347656, 81.96205139160156, 36.610443115234375, 43.5169677734375, 38.356021881103516, 43.6617546081543, 49.521888732910156, 45.75209426879883, 40.05087661743164, 37.20487976074219, 48.58631896972656, 37.89115905761719, 34.271148681640625, 37.794464111328125, 43.814430236816406, 43.36323165893555, 46.93346405029297, 39.93104934692383, 39.07731628417969, 40.375179290771484, 37.63447570800781, 50.520477294921875, 51.6554069519043, 44.22563552856445, 68.57736206054688, 40.122982025146484, 38.45543670654297, 47.99729537963867, 36.20463562011719, 36.353363037109375, 33.31547164916992, 56.66757583618164, 36.601806640625, 34.27615737915039, 43.25177764892578, 48.283138275146484, 35.79093551635742, 36.39683151245117, 41.8652229309082, 64.91627502441406, 36.667396545410156, 36.543922424316406, 36.004066467285156, 38.841644287109375, 51.922725677490234, 41.192562103271484, 39.88784408569336, 37.08061981201172, 40.418785095214844, 36.44654083251953, 40.753753662109375, 35.32508850097656, 32.3396110534668, 35.43086624145508, 31.503896713256836, 35.480430603027344, 31.879722595214844, 102.06411743164062, 37.80215072631836, 34.857627868652344, 33.29568862915039, 35.316001892089844, 34.495643615722656, 43.59776306152344, 36.60294723510742, 31.322410583496094, 44.706878662109375, 33.676292419433594, 37.13935852050781, 41.21446228027344, 35.3612174987793, 47.1668701171875, 34.92377853393555, 
34.45545959472656, 33.70030212402344, 38.900516510009766, 31.702489852905273, 36.67042541503906, 36.30320358276367, 35.2294807434082, 34.111778259277344, 40.99053192138672, 33.137908935546875, 34.3096809387207, 44.77338790893555, 33.17245864868164, 31.95186424255371, 34.94928741455078, 40.85205078125, 33.592716217041016, 37.775211334228516, 32.91325759887695, 35.927791595458984, 115.55352020263672, 32.80155563354492, 38.21519470214844, 34.784175872802734, 43.1331787109375, 36.98813247680664, 35.2777099609375, 37.028411865234375, 32.8520393371582, 38.23281478881836, 31.609344482421875, 39.78398513793945, 34.82811737060547, 36.73487854003906, 47.01777267456055, 36.10721206665039, 34.023780822753906, 34.18015670776367, 37.045318603515625, 40.258216857910156, 32.36241912841797, 37.75829315185547, 35.552616119384766]
'''
#걸린시간:  278.978 초
#loss:  22.1511173248291
#r2스코어 :  0.734980394071009
#stop_epoch=323
#patience=50
